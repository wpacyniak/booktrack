<!DOCTYPE html>
<html>
    <head>
        <title>Book track - year</title>
        <%- include ('resources/head.html') %>
    </head>

    <body>
        <%- include ('resources/header.ejs') %>
        <div class="container"> 
            <div class="row">
                <div class="col-xs-12 col-lg-9 col-xl-10 mx-auto" id="main_col">
                    <div>
                        <h3 class="text-center">Przeczytane w roku <%=current_year%>: </h3>
                        <table class="table">
                                <thead>
                                        <tr>
                                            <th scope="col"> </th>
                                            <th scope="col"> Tytuł </th>
                                            <th scope="col"> Autor </th>
                                            <th scope="col"> Liczba stron </th>
                                            <th scope="col"> Data zakończenia </th>
                                            <th scope="col"> Ocena </th>
                                        </tr>
                                </thead>
                                <tbody>
                                        <% var j = 0 %>
                                        <% for(let i=0; i < books.length; i++) { %>
                                                <% if (books[i].year == current_year && books[i].is_read == true) { j = j + 1 %>
                                                    <tr>
                                                        <th scope='row'> <%= j %> </th>
                                                        <td > <%=books[i].title%> </td>
                                                        <td > <%=books[i].author%> </td>
                                                        <td > <%=books[i].pages%> </td>
                                                        <td > <%=books[i].day%>-<%=books[i].month%>-<%=books[i].year%> </td>
                                                        <td > 
                                                            <% for(let x = 0; x < books[i].rate; x++) { %>
                                                            <span>&#x2B50; </span>
                                                            <% } %>
                                                        </td>
                                                    </tr>    
                                                <% } %>
                                        <% } %>
                                </tbody>
                        </table>
                    </div>
                    <div>
                        <canvas id="GraphBook"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
    </body>
    <script type="text/javascript">
        var dataB = new Array(12);
        for(let i = 0; i < dataB.length; i++) {
            for(let j = 0; j < books.length; j++) {
                if(books[j].year == current_year && books[j].month == i+1) {
                    dataB += books[j].pages;
                };
            };
        };
        var content = document.getElementById('GraphBook').getContext("2d");
        var myChart = new Chart(content, {
            type: 'bar',
            data: {
                labels: ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],
                datasets: [{
                    data: dataB,
                    backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                    'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero:true
                    }
                }
            }
        });
    </script>
</html>